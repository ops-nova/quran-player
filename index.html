<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আল-কোরআন প্রিমিয়াম প্লেয়ার</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#27ae60">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2874/2874810.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --accent-color: #27ae60;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f8fafc;
            --input-bg: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('https://images.unsplash.com/photo-1591604129939-f1efa4d9f7fa?auto=format&fit=crop&w=1350&q=80');
            background-size: cover; background-position: center; background-attachment: fixed;
            position: relative;
        }
        
        body::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.8); z-index: 0; 
        }

        .sidebar {
            position: fixed; top: 0; left: -280px; width: 280px; height: 100%;
            background: var(--card-bg); z-index: 100; transition: 0.4s;
            padding: 20px; border-right: 2px solid var(--accent-color);
            display: flex; flex-direction: column;
        }
        .sidebar.active { left: 0; }
        .menu-btn {
            position: fixed; top: 20px; left: 20px; z-index: 101;
            font-size: 20px; color: white; cursor: pointer; background: var(--accent-color);
            width: 45px; height: 45px; display: flex; justify-content: center; align-items: center; border-radius: 50%;
        }

        .container {
            position: relative; z-index: 1; background: var(--card-bg);
            width: 95%; max-width: 450px; padding: 25px; border-radius: 30px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }

        .player-img { 
            width: 100px; height: 100px; background: linear-gradient(45deg, var(--accent-color), #2ecc71); 
            margin: 0 auto 15px; border-radius: 50%; display: flex; justify-content: center; 
            align-items: center; font-size: 45px;
        }
        
        .progress-area { height: 6px; width: 100%; background: #455a64; border-radius: 50px; cursor: pointer; margin: 20px 0 10px; }
        .progress-bar { height: inherit; width: 0%; border-radius: inherit; background: var(--accent-color); }
        .timer-info { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 15px; color: #94a3b8; }

        .search-box, .select-box, .timer-input { width: 100%; padding: 12px; background: var(--input-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; margin-bottom: 12px; outline: none; }

        .surah-details { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .badge { background: #334155; padding: 4px 12px; border-radius: 20px; font-size: 11px; color: var(--accent-color); border: 1px solid var(--accent-color); }

        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .play-btn { width: 65px; height: 65px; background: var(--accent-color); border-radius: 50%; font-size: 22px; display: flex; justify-content: center; align-items: center; }

        .credit { margin-top: 25px; font-size: 13px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .credit a { color: var(--accent-color); text-decoration: none; font-weight: bold; }

        #contentOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 200; padding: 60px 20px; text-align: center; }
        
        /* Download Button Style */
        .download-btn { background: #34495e; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-size: 13px; margin-top: 15px; transition: 0.3s; }
        .download-btn:hover { background: #2c3e50; }
        .download-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="menu-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>

    <div class="sidebar" id="mySidebar">
        <h3 style="text-align:center; color:var(--accent-color); margin-bottom:20px;">ইসলামিক লাইব্রেরি</h3>
        <ul style="list-style:none;">
            <li onclick="showRandom('dua')" style="padding:15px; background:#334155; margin-bottom:10px; border-radius:10px; cursor:pointer;"><i class="fas fa-pray"></i> প্রয়োজনীয় দোয়া</li>
            <li onclick="showRandom('hadith')" style="padding:15px; background:#334155; margin-bottom:10px; border-radius:10px; cursor:pointer;"><i class="fas fa-book"></i> বুখারী শরিফ</li>
        </ul>
        <div style="margin-top:auto; text-align:center; padding-bottom:20px;">
            <p style="font-size:10px; opacity:0.5;">Developed by</p>
            <a href="https://www.facebook.com/ShaoN1101" target="_blank" style="color:var(--accent-color); font-weight:bold; text-decoration:none;">MD. SAMIUL ISLAM SHAON</a>
        </div>
    </div>

    <div id="contentOverlay">
        <span onclick="closeContent()" style="position:absolute; top:20px; right:25px; font-size:35px; cursor:pointer; color:red;">&times;</span>
        <h2 id="contentTitle" style="color:var(--accent-color); margin-bottom:20px;"></h2>
        <div id="contentText" style="line-height:1.8; font-size:18px; color:#ddd; padding:20px;"></div>
        <button onclick="showRandom(currentType)" style="margin-top:20px; padding:10px 20px; background:var(--accent-color); border:none; color:white; border-radius:50px; cursor:pointer;">আরেকটি দেখুন</button>
    </div>

    <div class="container">
        <div class="player-img"><i class="fas fa-quran"></i></div>
        <h2 id="displaySurahName">সুরা ফাতিহা</h2>
        <div class="surah-details">
            <span class="badge" id="surahType">মক্কী</span>
            <span class="badge" id="surahAyah">আয়াত: ৭</span>
        </div>

        <input type="text" id="surahSearch" class="search-box" placeholder="সুরা খুঁজুন...">
        <select id="surahSelect" class="select-box"></select>

        <div class="timer-section" style="display:flex; gap:5px;">
            <input type="number" id="timerMinutes" class="timer-input" placeholder="অটো অফ (মিনিট)" style="margin-bottom:0;">
            <button onclick="setTimer()" style="background:var(--accent-color); border:none; color:white; padding:0 15px; border-radius:10px; cursor:pointer; font-weight:bold;">SET</button>
        </div>
        <div id="timerDisplay" style="font-size:11px; color:#ff7675; margin: 5px 0;"></div>

        <div class="progress-area" id="progressArea"><div class="progress-bar" id="progressBar"></div></div>
        <div class="timer-info"><span id="current">0:00</span><span id="duration">0:00</span></div>

        <div class="controls">
            <button class="btn" onclick="prevSurah()"><i class="fas fa-step-backward"></i></button>
            <button class="btn play-btn" id="playPauseBtn" onclick="togglePlay()"><i class="fas fa-play"></i></button>
            <button class="btn" onclick="nextSurah()"><i class="fas fa-step-forward"></i></button>
        </div>

        <button id="downloadBtn" class="download-btn" onclick="downloadCurrentSurah()">
            <i class="fas fa-cloud-download-alt"></i> অফলাইন ডাউনলোড
        </button>
        <p id="dlStatus" style="font-size: 11px; margin-top: 5px; color: var(--accent-color); min-height: 15px;"></p>

        <div style="margin-top:15px; display:flex; align-items:center; justify-content:center; gap:10px;">
            <i class="fas fa-volume-up" style="font-size:12px; opacity:0.6;"></i>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.1" value="1" style="width:80px;">
        </div>

        <audio id="mainAudio"><source id="audioSrc" src="" type="audio/mpeg"></audio>

        <div class="credit">
            Develop by : <a href="https://www.facebook.com/ShaoN1101" target="_blank">MD. SAMIUL ISLAM SHAON</a>
        </div>
    </div>

    <script>
        // PWA Registration: এই অংশটুকু নতুন যুক্ত করা হয়েছে
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('Service Worker Registered'))
                    .catch(err => console.log('Service Worker Failed', err));
            });
        }

        let currentType = '';
        const surahSelect = document.getElementById('surahSelect');
        const mainAudio = document.getElementById('mainAudio');
        const audioSrc = document.getElementById('audioSrc');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressArea = document.getElementById('progressArea');
        const dlStatus = document.getElementById('dlStatus');
        const downloadBtn = document.getElementById('downloadBtn');
        let sleepTimer = null;

        const surahInfo = [
            {n:"ফাতিহা", t:"মক্কী", a:7}, {n:"বাকারা", t:"মাদানী", a:286}, {n:"আল ইমরান", t:"মাদানী", a:200}, {n:"নিসা", t:"মাদানী", a:176}, {n:"মায়িদাহ", t:"মাদানী", a:120}, {n:"আনআম", t:"মক্কী", a:165}, {n:"আরাফ", t:"মক্কী", a:206}, {n:"আনফাল", t:"মাদানী", a:75}, {n:"তাওবাহ", t:"মাদানী", a:129}, {n:"ইউনূস", t:"মক্কী", a:109}, {n:"হূদ", t:"মক্কী", a:123}, {n:"ইউসুফ", t:"মক্কী", a:111}, {n:"রাদ", t:"মাদানী", a:43}, {n:"ইব্রাহিম", t:"মক্কী", a:52}, {n:"হিজর", t:"মক্কী", a:99}, {n:"নাহল", t:"মক্কী", a:128}, {n:"ইসরা", t:"মক্কী", a:111}, {n:"কাহফ", t:"মক্কী", a:110}, {n:"মারইয়াম", t:"মক্কী", a:98}, {n:"তহা", t:"মক্কী", a:135}, {n:"আম্বিয়া", t:"মক্কী", a:112}, {n:"হজ", t:"মাদানী", a:78}, {n:"মুমিনুন", t:"মক্কী", a:118}, {n:"নূর", t:"মাদানী", a:64}, {n:"ফুরকান", t:"মক্কী", a:77}, {n:"শুয়ারা", t:"মক্কী", a:227}, {n:"নামল", t:"মক্কী", a:93}, {n:"কাসাস", t:"মক্কী", a:88}, {n:"আনকাবুত", t:"মক্কী", a:69}, {n:"রূম", t:"মক্কী", a:60}, {n:"লুকমান", t:"মক্কী", a:34}, {n:"সাজদাহ", t:"মক্কী", a:30}, {n:"আহজাব", t:"মাদানী", a:73}, {n:"সাবা", t:"মক্কী", a:54}, {n:"ফাতির", t:"মক্কী", a:45}, {n:"ইয়াসিন", t:"মক্কী", a:83}, {n:"সাফফাত", t:"মক্কী", a:182}, {n:"সোয়াদ", t:"মক্কী", a:88}, {n:"জুমার", t:"মক্কী", a:75}, {n:"গাফির", t:"মক্কী", a:85}, {n:"ফুসসিলাত", t:"মক্কী", a:54}, {n:"শুরা", t:"মক্কী", a:53}, {n:"জুখরুফ", t:"মক্কী", a:89}, {n:"দুখান", t:"মক্কী", a:59}, {n:"জাসিয়াহ", t:"মক্কী", a:37}, {n:"আহকফ", t:"মক্কী", a:35}, {n:"মুহাম্মদ", t:"মাদানী", a:38}, {n:"ফাতহ", t:"মাদানী", a:29}, {n:"হুজুরাত", t:"মাদানী", a:18}, {n:"কফ", t:"মক্কী", a:45}, {n:"যারিয়াত", t:"মক্কী", a:60}, {n:"তুর", t:"মক্কী", a:49}, {n:"নাজম", t:"মক্কী", a:62}, {n:"কামার", t:"মক্কী", a:55}, {n:"রাহমান", t:"মাদানী", a:78}, {n:"ওয়াকিআহ", t:"মক্কী", a:96}, {n:"হাদিদ", t:"মাদানী", a:29}, {n:"মুজাদালাহ", t:"মাদানী", a:22}, {n:"হাশর", t:"মাদানী", a:24}, {n:"মুমতাহিনাহ", t:"মাদানী", a:13}, {n:"সাফ", t:"মাদানী", a:14}, {n:"জুমুআহ", t:"মাদানী", a:11}, {n:"মুনাফিকুন", t:"মাদানী", a:11}, {n:"তাগাবুন", t:"মাদানী", a:18}, {n:"তালাক", t:"মাদানী", a:12}, {n:"তাহরিম", t:"মাদানী", a:12}, {n:"মুলক", t:"মক্কী", a:30}, {n:"কলম", t:"মক্কী", a:52}, {n:"হাক্কাহ", t:"মক্কী", a:52}, {n:"মাআরিজ", t:"মক্কী", a:44}, {n:"নূহ", t:"মক্কী", a:28}, {n:"জ্বিন", t:"মক্কী", a:28}, {n:"মুযযামমিল", t:"মক্কী", a:20}, {n:"মুদ্দাসসির", t:"মক্কী", a:56}, {n:"কিয়াহমাহ", t:"মক্কী", a:40}, {n:"ইনসান", t:"মাদানী", a:31}, {n:"মুরসালাত", t:"মক্কী", a:50}, {n:"নাবা", t:"মক্কী", a:40}, {n:"নাযিয়াত", t:"মক্কী", a:46}, {n:"আবাসা", t:"মক্কী", a:42}, {n:"তাকভির", t:"মক্কী", a:29}, {n:"ইনফিতার", t:"মক্কী", a:19}, {n:"মুতাফফিফিন", t:"মক্কী", a:36}, {n:"ইনশিকাক", t:"মক্কী", a:25}, {n:"বুরুজ", t:"মক্কী", a:22}, {n:"তারিক", t:"মক্কী", a:17}, {n:"আলা", t:"মক্কী", a:19}, {n:"গাশিয়াহ", t:"মক্কী", a:26}, {n:"ফজর", t:"মক্কী", a:30}, {n:"বালাদ", t:"মক্কী", a:20}, {n:"শামস", t:"মক্কী", a:15}, {n:"লাইল", t:"মক্কী", a:21}, {n:"দুহা", t:"মক্কী", a:11}, {n:"শারহ", t:"মক্কী", a:8}, {n:"তিন", t:"মক্কী", a:8}, {n:"আলাক", t:"মক্কী", a:19}, {n:"কদর", t:"মক্কী", a:5}, {n:"বাইয়িনাহ", t:"মাদানী", a:8}, {n:"যিলযাল", t:"মাদানী", a:8}, {n:"আদিয়াত", t:"মক্কী", a:11}, {n:"কারিয়াহ", t:"মক্কী", a:11}, {n:"তাকাসুর", t:"মক্কী", a:8}, {n:"আসর", t:"মক্কী", a:3}, {n:"হুমাযাহ", t:"মক্কী", a:9}, {n:"ফিল", t:"মক্কী", a:5}, {n:"কুরাইশ", t:"মক্কী", a:4}, {n:"মাউন", t:"মক্কী", a:7}, {n:"কাওসার", t:"মক্কী", a:3}, {n:"কাফিরুন", t:"মক্কী", a:6}, {n:"নাসর", t:"মাদানী", a:3}, {n:"লাহাব", t:"মক্কী", a:5}, {n:"ইখলাস", t:"মক্কী", a:4}, {n:"ফালাক", t:"মক্কী", a:5}, {n:"নাস", t:"মক্কী", a:6}
        ];

        const hadithData = ["রাসূলুল্লাহ (সাঃ) বলেছেনঃ 'নিশ্চয়ই সকল আমল নিয়তের ওপর নির্ভরশীল।' (বুখারী)", "রাসূলুল্লাহ (সাঃ) বলেছেনঃ 'পবিত্রতা ঈমানের অর্ধেক।' (মুসলিম)", "রাসূলুল্লাহ (সাঃ) বলেছেনঃ 'তোমাদের মধ্যে সেই উত্তম যে কুরআন শিখে এবং শেখায়।' (বুখারী)"];
        const duaData = ["বিপদ মুক্তির দোয়া: লা ইলাহা ইল্লা আন্তা সুবহানাকা ইন্নি কুনতু মিনায যলিমীন।", "ক্ষমা চাওয়ার দোয়া: রাব্বিগফির ওয়ারহাম ওয়া আনতা খায়রুর রাহিমীন।"];

        function toggleSidebar() { document.getElementById('mySidebar').classList.toggle('active'); }
        function closeContent() { document.getElementById('contentOverlay').style.display = 'none'; }

        function showRandom(type) {
            currentType = type;
            document.getElementById('contentOverlay').style.display = 'block';
            toggleSidebar();
            if(type === 'dua') {
                document.getElementById('contentTitle').innerText = "প্রয়োজনীয় দোয়া";
                document.getElementById('contentText').innerText = duaData[Math.floor(Math.random()*duaData.length)];
            } else {
                document.getElementById('contentTitle').innerText = "বুখারী শরিফ";
                document.getElementById('contentText').innerText = hadithData[Math.floor(Math.random()*hadithData.length)];
            }
        }

        function populateSurahs(filter = '') {
            surahSelect.innerHTML = '';
            surahInfo.forEach((info, i) => {
                if(info.n.includes(filter)) {
                    let opt = document.createElement('option');
                    opt.value = (i+1).toString().padStart(3, '0');
                    opt.textContent = `${i+1}. সুরা ${info.n}`;
                    surahSelect.appendChild(opt);
                }
            });
        }

        function loadSurah(id) {
            const index = parseInt(id) - 1;
            const info = surahInfo[index];
            document.getElementById('displaySurahName').innerText = "সুরা " + info.n;
            document.getElementById('surahType').innerText = info.t;
            document.getElementById('surahAyah').innerText = "আয়াত: " + info.a;
            
            audioSrc.src = `https://server8.mp3quran.net/afs/${id}.mp3`;
            mainAudio.load();
            dlStatus.innerText = "";
            togglePlay(true);
        }

        function togglePlay(forcePlay = false) {
            if (mainAudio.paused || forcePlay) {
                mainAudio.play().catch(() => {});
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                mainAudio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        async function downloadCurrentSurah() {
            const id = surahSelect.value;
            const url = `https://server8.mp3quran.net/afs/${id}.mp3`;
            if (!('caches' in window)) return alert("আপনার ব্রাউজার অফলাইন সাপোর্ট করে না।");
            try {
                downloadBtn.disabled = true;
                dlStatus.style.color = "var(--accent-color)";
                dlStatus.innerText = "ডাউনলোড হচ্ছে... অনুগ্রহ করে অপেক্ষা করুন।";
                const cache = await caches.open('quran-offline-cache');
                await cache.add(url);
                dlStatus.innerText = "সফলভাবে ডাউনলোড হয়েছে! এখন অফলাইনেও শুনতে পারবেন।";
                downloadBtn.innerHTML = '<i class="fas fa-check"></i> ডাউনলোড সম্পন্ন';
            } catch (err) {
                dlStatus.style.color = "#ff7675";
                dlStatus.innerText = "ডাউনলোড ব্যর্থ! ইন্টারনেট কানেকশন চেক করুন।";
                console.error(err);
            } finally {
                downloadBtn.disabled = false;
            }
        }

        mainAudio.ontimeupdate = (e) => {
            const currentTime = e.target.currentTime;
            const duration = e.target.duration;
            progressBar.style.width = `${(currentTime / duration) * 100}%`;
            let curMin = Math.floor(currentTime/60);
            let curSec = Math.floor(currentTime%60);
            document.getElementById('current').innerText = `${curMin}:${curSec < 10 ? '0'+curSec : curSec}`;
        };

        mainAudio.onloadeddata = () => {
            let durMin = Math.floor(mainAudio.duration/60);
            let durSec = Math.floor(mainAudio.duration%60);
            document.getElementById('duration').innerText = `${durMin}:${durSec < 10 ? '0'+durSec : durSec}`;
        };

        progressArea.onclick = (e) => {
            mainAudio.currentTime = (e.offsetX / progressArea.clientWidth) * mainAudio.duration;
        };

        document.getElementById('volumeSlider').oninput = (e) => mainAudio.volume = e.target.value;

        function nextSurah() {
            let nextId = parseInt(surahSelect.value) + 1;
            if(nextId > 114) nextId = 1;
            surahSelect.value = nextId.toString().padStart(3, '0');
            loadSurah(surahSelect.value);
        }

        function prevSurah() {
            let prevId = parseInt(surahSelect.value) - 1;
            if(prevId < 1) prevId = 114;
            surahSelect.value = prevId.toString().padStart(3, '0');
            loadSurah(prevId.toString().padStart(3, '0'));
        }

        function setTimer() {
            const mins = document.getElementById('timerMinutes').value;
            if(!mins || mins <= 0) return;
            let time = mins * 60;
            if(sleepTimer) clearInterval(sleepTimer);
            sleepTimer = setInterval(() => {
                time--;
                document.getElementById('timerDisplay').innerText = `বন্ধ হবে: ${Math.floor(time/60)}:${time%60 < 10 ? '0'+time%60 : time%60}`;
                if(time <= 0) { clearInterval(sleepTimer); mainAudio.pause(); playPauseBtn.innerHTML = '<i class="fas fa-play"></i>'; }
            }, 1000);
            alert("টাইমার সেট হয়েছে!");
        }

        surahSelect.onchange = () => loadSurah(surahSelect.value);
        document.getElementById('surahSearch').oninput = (e) => populateSurahs(e.target.value);
        mainAudio.onended = () => nextSurah();

        window.onload = () => { 
            populateSurahs(); 
            surahSelect.value = '001'; 
            loadSurah('001'); 
            mainAudio.pause(); 
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        };
    </script>
</body>
</html>