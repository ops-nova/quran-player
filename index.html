<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QURAN PLAYER</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#27ae60">
    <link rel="apple-touch-icon" href="icon.jpg">
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --accent-color: #27ae60;
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f8fafc;
            --input-bg: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-image: url('https://images.unsplash.com/photo-1591604129939-f1efa4d9f7fa?auto=format&fit=crop&w=1350&q=80');
            background-size: cover; background-position: center; background-attachment: fixed;
            position: relative;
        }
        
        body::before { 
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0, 0, 0, 0.8); z-index: 0; 
        }

        /* Install Button for Browser */
        #installContainer {
            position: fixed; top: 20px; right: 20px; z-index: 1000; display: none;
        }
        .install-btn {
            background: var(--accent-color); color: white; border: none; padding: 10px 20px;
            border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .container {
            position: relative; z-index: 1; background: var(--card-bg);
            width: 95%; max-width: 450px; padding: 25px; border-radius: 30px; 
            text-align: center; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 25px 50px rgba(0,0,0,0.6);
        }

        .player-img-container { 
            width: 100px; height: 100px; margin: 0 auto 15px; 
            border-radius: 50%; border: 3px solid var(--accent-color);
            overflow: hidden; background: var(--accent-color);
            display: flex; justify-content: center; align-items: center;
        }
        .player-img-container img { width: 100%; height: 100%; object-fit: cover; }
        
        .progress-area { height: 6px; width: 100%; background: #455a64; border-radius: 50px; cursor: pointer; margin: 20px 0 10px; }
        .progress-bar { height: inherit; width: 0%; border-radius: inherit; background: var(--accent-color); }
        .timer-info { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 15px; color: #94a3b8; }

        .search-box, .select-box, .timer-input { width: 100%; padding: 12px; background: var(--input-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; margin-bottom: 12px; outline: none; }

        .surah-details { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; }
        .badge { background: #334155; padding: 4px 12px; border-radius: 20px; font-size: 11px; color: var(--accent-color); border: 1px solid var(--accent-color); }

        .controls { display: flex; justify-content: center; align-items: center; gap: 20px; }
        .btn { background: none; border: none; color: white; font-size: 24px; cursor: pointer; }
        .play-btn { width: 65px; height: 65px; background: var(--accent-color); border-radius: 50%; font-size: 22px; display: flex; justify-content: center; align-items: center; }

        .download-btn { background: #34495e; color: white; border: none; padding: 10px 20px; border-radius: 25px; cursor: pointer; font-size: 13px; margin-top: 15px; transition: 0.3s; }
        .share-btn { background: transparent; color: #94a3b8; border: 1px solid #94a3b8; padding: 8px 20px; border-radius: 25px; cursor: pointer; font-size: 13px; margin-top: 15px; width: 100%; }

        .credit { margin-top: 25px; font-size: 13px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .credit a { color: var(--accent-color); text-decoration: none; font-weight: bold; }

        /* Update Alert Box */
        #update-banner {
            display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: var(--accent-color); color: white; padding: 12px 25px; border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); z-index: 1000; cursor: pointer; font-weight: bold;
        }
    </style>
</head>
<body>

    <div id="installContainer">
        <button class="install-btn" onclick="installApp()"><i class="fas fa-download"></i> INSTALL</button>
    </div>

    <div class="container">
        <div class="player-img-container">
            <img src="icon.jpg" alt="Logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/2874/2874810.png'">
        </div>

        <h2 id="displaySurahName">‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶´‡¶æ‡¶§‡¶ø‡¶π‡¶æ</h2>
        <div class="surah-details">
            <span class="badge" id="surahType">‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ</span>
            <span class="badge" id="surahAyah">‡¶Ü‡ßü‡¶æ‡¶§: ‡ß≠</span>
        </div>

        <input type="text" id="surahSearch" class="search-box" placeholder="‡¶∏‡ßÅ‡¶∞‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
        <select id="surahSelect" class="select-box"></select>

        <div style="display:flex; gap:5px;">
            <input type="number" id="timerMinutes" class="timer-input" placeholder="‡¶Ö‡¶ü‡ßã ‡¶Ö‡¶´ (‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü)" style="margin-bottom:0;">
            <button onclick="setTimer()" style="background:var(--accent-color); border:none; color:white; padding:0 15px; border-radius:10px; cursor:pointer;">SET</button>
        </div>
        <div id="timerDisplay" style="font-size:11px; color:#ff7675; margin: 5px 0;"></div>

        <div class="progress-area" id="progressArea"><div class="progress-bar" id="progressBar"></div></div>
        <div class="timer-info"><span id="current">0:00</span><span id="duration">0:00</span></div>

        <div class="controls">
            <button class="btn" onclick="prevSurah()"><i class="fas fa-step-backward"></i></button>
            <button class="btn play-btn" id="playPauseBtn" onclick="togglePlay()"><i class="fas fa-play"></i></button>
            <button class="btn" onclick="nextSurah()"><i class="fas fa-step-forward"></i></button>
        </div>

        <button id="downloadBtn" class="download-btn" onclick="downloadCurrentSurah()">
            <i class="fas fa-cloud-download-alt"></i> ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
        </button>
        <p id="dlStatus" style="font-size: 11px; margin-top: 5px; color: var(--accent-color); min-height: 15px;"></p>

        <button class="share-btn" onclick="shareApp()">
            <i class="fas fa-share-alt"></i> ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>

        <div class="credit">
            Develop by : <a href="https://www.facebook.com/ShaoN1101" target="_blank">MD. SAMIUL ISLAM SHAON</a>
        </div>
    </div>

    <div id="update-banner" onclick="window.location.reload()">
        ‡¶®‡¶§‡ßÅ‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶ó‡ßá‡¶õ‡ßá! ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
    </div>

    <audio id="mainAudio"><source id="audioSrc" src="" type="audio/mpeg"></audio>

    <script>
        // PWA & Update Detection
        let deferredPrompt;
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').then(reg => {
                    reg.onupdatefound = () => {
                        const installingWorker = reg.installing;
                        installingWorker.onstatechange = () => {
                            if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                document.getElementById('update-banner').style.display = 'block';
                            }
                        };
                    };
                });
            });
        }

        // Install App Logic
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            if (!window.matchMedia('(display-mode: standalone)').matches) {
                document.getElementById('installContainer').style.display = 'block';
            }
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt = null;
                document.getElementById('installContainer').style.display = 'none';
            }
        }

        // Share App Logic (Invatitaion Message 3)
        function shareApp() {
            const shareText = `‡¶ï‡ßã‡¶∞‡¶Ü‡¶® ‡¶∂‡ßÅ‡¶®‡ßÅ‡¶® ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶õ‡¶æ‡ßú‡¶æ‡¶á! üéßüìñ\n\n‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶§‡¶ø‡¶≤‡¶æ‡¶ì‡ßü‡¶æ‡¶§ ‡¶ì ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ‡¶∏‡¶π QURAN PLAYER ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø ‡¶ü‡ßç‡¶∞‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®‡•§\n‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï: ${window.location.href}\n\n‡¶≠‡¶æ‡¶≤‡ßã ‡¶≤‡¶æ‡¶ó‡¶≤‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®! üåπ`;
            if (navigator.share) {
                navigator.share({ title: 'QURAN PLAYER', text: shareText }).catch(console.error);
            } else {
                navigator.clipboard.writeText(shareText);
                alert("‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡¶∏‡¶π ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡¶®‡•§");
            }
        }

        // Player Logic
        const surahSelect = document.getElementById('surahSelect');
        const mainAudio = document.getElementById('mainAudio');
        const audioSrc = document.getElementById('audioSrc');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const progressBar = document.getElementById('progressBar');
        const progressArea = document.getElementById('progressArea');
        const dlStatus = document.getElementById('dlStatus');
        let sleepTimer = null;

        const surahInfo = [
            {n:"‡¶´‡¶æ‡¶§‡¶ø‡¶π‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:7}, {n:"‡¶¨‡¶æ‡¶ï‡¶æ‡¶∞‡¶æ", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:286}, {n:"‡¶Ü‡¶≤ ‡¶á‡¶Æ‡¶∞‡¶æ‡¶®", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:200}, {n:"‡¶®‡¶ø‡¶∏‡¶æ", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:176}, {n:"‡¶Æ‡¶æ‡¶Ø‡¶º‡¶ø‡¶¶‡¶æ‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:120}, {n:"‡¶Ü‡¶®‡¶Ü‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:165}, {n:"‡¶Ü‡¶∞‡¶æ‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:206}, {n:"‡¶Ü‡¶®‡¶´‡¶æ‡¶≤", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:75}, {n:"‡¶§‡¶æ‡¶ì‡¶¨‡¶æ‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:129}, {n:"‡¶á‡¶â‡¶®‡ßÇ‡¶∏", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:109}, {n:"‡¶π‡ßÇ‡¶¶", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:123}, {n:"‡¶á‡¶â‡¶∏‡ßÅ‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:111}, {n:"‡¶∞‡¶æ‡¶¶", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:43}, {n:"‡¶á‡¶¨‡ßç‡¶∞‡¶æ‡¶π‡¶ø‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:52}, {n:"‡¶π‡¶ø‡¶ú‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:99}, {n:"‡¶®‡¶æ‡¶π‡¶≤", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:128}, {n:"‡¶á‡¶∏‡¶∞‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:111}, {n:"‡¶ï‡¶æ‡¶π‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:110}, {n:"‡¶Æ‡¶æ‡¶∞‡¶á‡¶Ø‡¶º‡¶æ‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:98}, {n:"‡¶§‡¶π‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:135}, {n:"‡¶Ü‡¶Æ‡ßç‡¶¨‡¶ø‡¶Ø‡¶º‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:112}, {n:"‡¶π‡¶ú", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:78}, {n:"‡¶Æ‡ßÅ‡¶Æ‡¶ø‡¶®‡ßÅ‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:118}, {n:"‡¶®‡ßÇ‡¶∞", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:64}, {n:"‡¶´‡ßÅ‡¶∞‡¶ï‡¶æ‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:77}, {n:"‡¶∂‡ßÅ‡¶Ø‡¶º‡¶æ‡¶∞‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:227}, {n:"‡¶®‡¶æ‡¶Æ‡¶≤", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:93}, {n:"‡¶ï‡¶æ‡¶∏‡¶æ‡¶∏", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:88}, {n:"‡¶Ü‡¶®‡¶ï‡¶æ‡¶¨‡ßÅ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:69}, {n:"‡¶∞‡ßÇ‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:60}, {n:"‡¶≤‡ßÅ‡¶ï‡¶Æ‡¶æ‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:34}, {n:"‡¶∏‡¶æ‡¶ú‡¶¶‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:30}, {n:"‡¶Ü‡¶π‡¶ú‡¶æ‡¶¨", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:73}, {n:"‡¶∏‡¶æ‡¶¨‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:54}, {n:"‡¶´‡¶æ‡¶§‡¶ø‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:45}, {n:"‡¶á‡¶Ø‡¶º‡¶æ‡¶∏‡¶ø‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:83}, {n:"‡¶∏‡¶æ‡¶´‡¶´‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:182}, {n:"‡¶∏‡ßã‡¶Ø‡¶º‡¶æ‡¶¶", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:88}, {n:"‡¶ú‡ßÅ‡¶Æ‡¶æ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:75}, {n:"‡¶ó‡¶æ‡¶´‡¶ø‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:85}, {n:"‡¶´‡ßÅ‡¶∏‡¶∏‡¶ø‡¶≤‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:54}, {n:"‡¶∂‡ßÅ‡¶∞‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:53}, {n:"‡¶ú‡ßÅ‡¶ñ‡¶∞‡ßÅ‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:89}, {n:"‡¶¶‡ßÅ‡¶ñ‡¶æ‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:59}, {n:"‡¶ú‡¶æ‡¶∏‡¶ø‡¶Ø‡¶º‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:37}, {n:"‡¶Ü‡¶π‡¶ï‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:35}, {n:"‡¶Æ‡ßÅ‡¶π‡¶æ‡¶Æ‡ßç‡¶Æ‡¶¶", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:38}, {n:"‡¶´‡¶æ‡¶§‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:29}, {n:"‡¶π‡ßÅ‡¶ú‡ßÅ‡¶∞‡¶æ‡¶§", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:18}, {n:"‡¶ï‡¶´", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:45}, {n:"‡¶Ø‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:60}, {n:"‡¶§‡ßÅ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:49}, {n:"‡¶®‡¶æ‡¶ú‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:62}, {n:"‡¶ï‡¶æ‡¶Æ‡¶æ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:55}, {n:"‡¶∞‡¶æ‡¶π‡¶Æ‡¶æ‡¶®", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:78}, {n:"‡¶ì‡¶Ø‡¶º‡¶æ‡¶ï‡¶ø‡¶Ü‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:96}, {n:"‡¶π‡¶æ‡¶¶‡¶ø‡¶¶", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:29}, {n:"‡¶Æ‡ßÅ‡¶ú‡¶æ‡¶¶‡¶æ‡¶≤‡¶æ‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:22}, {n:"‡¶π‡¶æ‡¶∂‡¶∞", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:24}, {n:"‡¶Æ‡ßÅ‡¶Æ‡¶§‡¶æ‡¶π‡¶ø‡¶®‡¶æ‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:13}, {n:"‡¶∏‡¶æ‡¶´", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:14}, {n:"‡¶ú‡ßÅ‡¶Æ‡ßÅ‡¶Ü‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:11}, {n:"‡¶Æ‡ßÅ‡¶®‡¶æ‡¶´‡¶ø‡¶ï‡ßÅ‡¶®", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:11}, {n:"‡¶§‡¶æ‡¶ó‡¶æ‡¶¨‡ßÅ‡¶®", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:18}, {n:"‡¶§‡¶æ‡¶≤‡¶æ‡¶ï", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:12}, {n:"‡¶§‡¶æ‡¶π‡¶∞‡¶ø‡¶Æ", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:12}, {n:"‡¶Æ‡ßÅ‡¶≤‡¶ï", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:30}, {n:"‡¶ï‡¶≤‡¶Æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:52}, {n:"‡¶π‡¶æ‡¶ï‡ßç‡¶ï‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:52}, {n:"‡¶Æ‡¶æ‡¶Ü‡¶∞‡¶ø‡¶ú", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:44}, {n:"‡¶®‡ßÇ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:28}, {n:"‡¶ú‡ßç‡¶¨‡¶ø‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:28}, {n:"‡¶Æ‡ßÅ‡¶Ø‡¶Ø‡¶æ‡¶Æ‡¶Æ‡¶ø‡¶≤", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:20}, {n:"‡¶Æ‡ßÅ‡¶¶‡ßç‡¶¶‡¶æ‡¶∏‡¶∏‡¶ø‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:56}, {n:"‡¶ï‡¶ø‡¶Ø‡¶º‡¶æ‡¶π‡¶Æ‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:40}, {n:"‡¶á‡¶®‡¶∏‡¶æ‡¶®", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:31}, {n:"‡¶Æ‡ßÅ‡¶∞‡¶∏‡¶æ‡¶≤‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:50}, {n:"‡¶®‡¶æ‡¶¨‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:40}, {n:"‡¶®‡¶æ‡¶Ø‡¶ø‡¶Ø‡¶º‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:46}, {n:"‡¶Ü‡¶¨‡¶æ‡¶∏‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:42}, {n:"‡¶§‡¶æ‡¶ï‡¶≠‡¶ø‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:29}, {n:"‡¶á‡¶®‡¶´‡¶ø‡¶§‡¶æ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:19}, {n:"‡¶Æ‡ßÅ‡¶§‡¶æ‡¶´‡¶´‡¶ø‡¶´‡¶ø‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:36}, {n:"‡¶á‡¶®‡¶∂‡¶ø‡¶ï‡¶æ‡¶ï", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:25}, {n:"‡¶¨‡ßÅ‡¶∞‡ßÅ‡¶ú", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:22}, {n:"‡¶§‡¶æ‡¶∞‡¶ø‡¶ï", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:17}, {n:"‡¶Ü‡¶≤‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:19}, {n:"‡¶ó‡¶æ‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:26}, {n:"‡¶´‡¶ú‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:30}, {n:"‡¶¨‡¶æ‡¶≤‡¶æ‡¶¶", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:20}, {n:"‡¶∂‡¶æ‡¶Æ‡¶∏", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:15}, {n:"‡¶≤‡¶æ‡¶á‡¶≤", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:21}, {n:"‡¶¶‡ßÅ‡¶π‡¶æ", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:11}, {n:"‡¶∂‡¶æ‡¶∞‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:8}, {n:"‡¶§‡¶ø‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:8}, {n:"‡¶Ü‡¶≤‡¶æ‡¶ï", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:19}, {n:"‡¶ï‡¶¶‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:5}, {n:"‡¶¨‡¶æ‡¶á‡¶Ø‡¶º‡¶ø‡¶®‡¶æ‡¶π", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:8}, {n:"‡¶Ø‡¶ø‡¶≤‡¶Ø‡¶æ‡¶≤", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:8}, {n:"‡¶Ü‡¶¶‡¶ø‡¶Ø‡¶º‡¶æ‡¶§", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:11}, {n:"‡¶ï‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:11}, {n:"‡¶§‡¶æ‡¶ï‡¶æ‡¶∏‡ßÅ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:8}, {n:"‡¶Ü‡¶∏‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:3}, {n:"‡¶π‡ßÅ‡¶Æ‡¶æ‡¶Ø‡¶æ‡¶π", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:9}, {n:"‡¶´‡¶ø‡¶≤", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:5}, {n:"‡¶ï‡ßÅ‡¶∞‡¶æ‡¶á‡¶∂", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:4}, {n:"‡¶Æ‡¶æ‡¶â‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:7}, {n:"‡¶ï‡¶æ‡¶ì‡¶∏‡¶æ‡¶∞", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:3}, {n:"‡¶ï‡¶æ‡¶´‡¶ø‡¶∞‡ßÅ‡¶®", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:6}, {n:"‡¶®‡¶æ‡¶∏‡¶∞", t:"‡¶Æ‡¶æ‡¶¶‡¶æ‡¶®‡ßÄ", a:3}, {n:"‡¶≤‡¶æ‡¶π‡¶æ‡¶¨", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:5}, {n:"‡¶á‡¶ñ‡¶≤‡¶æ‡¶∏", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:4}, {n:"‡¶´‡¶æ‡¶≤‡¶æ‡¶ï", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:5}, {n:"‡¶®‡¶æ‡¶∏", t:"‡¶Æ‡¶ï‡ßç‡¶ï‡ßÄ", a:6}
        ];

        function populateSurahs(filter = '') {
            surahSelect.innerHTML = '';
            surahInfo.forEach((info, i) => {
                if(info.n.includes(filter)) {
                    let opt = document.createElement('option');
                    opt.value = (i+1).toString().padStart(3, '0');
                    opt.textContent = `${i+1}. ‡¶∏‡ßÅ‡¶∞‡¶æ ${info.n}`;
                    surahSelect.appendChild(opt);
                }
            });
        }

        function loadSurah(id) {
            const index = parseInt(id) - 1;
            const info = surahInfo[index];
            document.getElementById('displaySurahName').innerText = "‡¶∏‡ßÅ‡¶∞‡¶æ " + info.n;
            document.getElementById('surahType').innerText = info.t;
            document.getElementById('surahAyah').innerText = "‡¶Ü‡ßü‡¶æ‡¶§: " + info.a;
            audioSrc.src = `https://server8.mp3quran.net/afs/${id}.mp3`;
            mainAudio.load();
            dlStatus.innerText = "";
            togglePlay(true);
        }

        function togglePlay(forcePlay = false) {
            if (mainAudio.paused || forcePlay) {
                mainAudio.play().catch(() => {});
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                mainAudio.pause();
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        async function downloadCurrentSurah() {
            const id = surahSelect.value;
            const url = `https://server8.mp3quran.net/afs/${id}.mp3`;
            if (!('caches' in window)) return alert("‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á");
            try {
                dlStatus.innerText = "‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
                const cache = await caches.open('quran-offline-cache');
                await cache.add(url);
                dlStatus.innerText = "‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
            } catch (err) {
                dlStatus.innerText = "‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•!";
            }
        }

        mainAudio.ontimeupdate = (e) => {
            const currentTime = e.target.currentTime;
            const duration = e.target.duration;
            progressBar.style.width = `${(currentTime / duration) * 100}%`;
            let curMin = Math.floor(currentTime/60);
            let curSec = Math.floor(currentTime%60);
            document.getElementById('current').innerText = `${curMin}:${curSec < 10 ? '0'+curSec : curSec}`;
        };

        mainAudio.onloadeddata = () => {
            let durMin = Math.floor(mainAudio.duration/60);
            let durSec = Math.floor(mainAudio.duration%60);
            document.getElementById('duration').innerText = `${durMin}:${durSec < 10 ? '0'+durSec : durSec}`;
        };

        progressArea.onclick = (e) => {
            mainAudio.currentTime = (e.offsetX / progressArea.clientWidth) * mainAudio.duration;
        };

        function nextSurah() {
            let nextId = parseInt(surahSelect.value) + 1;
            if(nextId > 114) nextId = 1;
            surahSelect.value = nextId.toString().padStart(3, '0');
            loadSurah(surahSelect.value);
        }

        function prevSurah() {
            let prevId = parseInt(surahSelect.value) - 1;
            if(prevId < 1) prevId = 114;
            surahSelect.value = prevId.toString().padStart(3, '0');
            loadSurah(surahSelect.value);
        }

        function setTimer() {
            const mins = document.getElementById('timerMinutes').value;
            if(!mins) return;
            let time = mins * 60;
            if(sleepTimer) clearInterval(sleepTimer);
            sleepTimer = setInterval(() => {
                time--;
                document.getElementById('timerDisplay').innerText = `‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶¨‡ßá: ${Math.floor(time/60)}:${time%60 < 10 ? '0'+time%60 : time%60}`;
                if(time <= 0) { clearInterval(sleepTimer); mainAudio.pause(); playPauseBtn.innerHTML = '<i class="fas fa-play"></i>'; }
            }, 1000);
            alert("‡¶ü‡¶æ‡¶á‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }

        surahSelect.onchange = () => loadSurah(surahSelect.value);
        document.getElementById('surahSearch').oninput = (e) => populateSurahs(e.target.value);
        mainAudio.onended = () => nextSurah();

        window.onload = () => { 
            populateSurahs(); 
            surahSelect.value = '001'; 
            loadSurah('001'); 
            mainAudio.pause(); 
            playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
        };
    </script>
</body>
</html>
